import{l as A,c as r,a as t,i as V,F as v,y as k,e as i,v as m,L as U,M as j,d as E,t as u,K as b,r as c,o as d,p as M}from"./index-DnaU9Zpc.js";const F={class:"p-6"},I={key:0,class:"text-gatales-text-secondary"},O={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},T={class:"flex justify-between items-start mb-4"},$={class:"text-lg font-semibold text-gatales-text"},q={class:"text-sm text-gatales-text-secondary"},R={class:"space-y-2 mb-4"},G={class:"flex justify-between"},K={class:"text-gatales-text font-medium"},J={class:"flex justify-between"},Q={class:"text-gatales-text font-medium"},W={class:"flex justify-between"},X={class:"text-gatales-text font-medium"},Y={class:"flex justify-between"},Z={class:"text-gatales-text font-medium"},tt={class:"flex justify-between"},et={class:"text-gatales-text font-medium text-sm"},st={class:"flex justify-between"},lt={class:"text-gatales-text font-medium text-sm font-mono"},at={class:"flex gap-2"},ot=["onClick"],nt=["onClick","disabled"],it={key:0,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},rt={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},dt={class:"space-y-3 mb-4"},ut=["value"],mt={class:"flex items-center gap-2"},ct={class:"flex gap-2"},xt=["onClick"],vt={key:2,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},ft={class:"card max-w-md w-full"},pt={class:"space-y-3 mb-4"},bt=["value"],yt={class:"flex items-center gap-2"},gt={class:"flex gap-2"},_t=["disabled"],kt=["disabled"],wt={key:0,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},Pt={__name:"PlansView",setup(Ct){const w=c([]),y=c(!0),g=c(null),o=c({}),_=c(!1),x=c(!1),f=c(null),n=c({name:"",tokens_monthly:1e5,price:0,duration_months:1,hotmart_product_id:"",hotmart_offer_code:"",is_active:!0}),C=[{value:1,label:"1 mes"},{value:3,label:"3 meses"},{value:12,label:"12 meses (anual)"}];async function p(){y.value=!0;try{const l=await b.getPlans();w.value=l.data.plans}catch(l){console.error("Error fetching plans:",l)}finally{y.value=!1}}A(p);function D(l){g.value=l.id,o.value={name:l.name,tokens_monthly:l.tokens_monthly,price:l.price,duration_months:l.duration_months||1,hotmart_product_id:l.hotmart_product_id||"",hotmart_offer_code:l.hotmart_offer_code||"",is_active:l.is_active}}function h(){g.value=null,o.value={}}async function H(l){try{await b.updatePlan(l,o.value),await p(),h()}catch{alert("Error al actualizar el plan")}}function N(){n.value={name:"",tokens_monthly:1e5,price:0,duration_months:1,hotmart_product_id:"",hotmart_offer_code:"",is_active:!0},_.value=!0}function P(){_.value=!1}async function S(){if(!n.value.name.trim()){alert("El nombre es requerido");return}x.value=!0;try{await b.createPlan(n.value),await p(),P()}catch(l){alert(l.response?.data?.message||"Error al crear el plan")}finally{x.value=!1}}async function z(l){if(l.active_subscriptions>0){alert(`No se puede eliminar el plan porque tiene ${l.active_subscriptions} suscripciones activas`);return}if(l.slug==="free"){alert("No se puede eliminar el plan gratuito");return}if(confirm(`¿Estas seguro de eliminar el plan "${l.name}"?`)){f.value=l.id;try{await b.deletePlan(l.id),await p()}catch(e){alert(e.response?.data?.message||"Error al eliminar el plan")}finally{f.value=null}}}function B(l){return l?.toLocaleString("es-ES")||"0"}function L(l){return new Intl.NumberFormat("es-ES",{style:"currency",currency:"USD"}).format(l)}return(l,e)=>(d(),r("div",F,[t("div",{class:"flex justify-between items-center mb-6"},[e[15]||(e[15]=t("h1",{class:"text-2xl font-bold text-gatales-text"},"Planes",-1)),t("button",{onClick:N,class:"btn-primary flex items-center gap-2"},[...e[14]||(e[14]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),V(" Nuevo Plan ",-1)])])]),y.value?(d(),r("div",I,"Cargando...")):(d(),r("div",O,[(d(!0),r(v,null,k(w.value,s=>(d(),r("div",{key:s.id,class:"card"},[g.value!==s.id?(d(),r(v,{key:0},[t("div",T,[t("div",null,[t("h3",$,u(s.name),1),t("p",q,u(s.slug),1)]),t("span",{class:M(["px-2 py-1 rounded text-xs",s.is_active?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"])},u(s.is_active?"Activo":"Inactivo"),3)]),t("div",R,[t("div",G,[e[16]||(e[16]=t("span",{class:"text-gatales-text-secondary"},"Tokens mensuales",-1)),t("span",K,u(B(s.tokens_monthly)),1)]),t("div",J,[e[17]||(e[17]=t("span",{class:"text-gatales-text-secondary"},"Precio",-1)),t("span",Q,u(L(s.price)),1)]),t("div",W,[e[18]||(e[18]=t("span",{class:"text-gatales-text-secondary"},"Duración",-1)),t("span",X,u(s.duration_months===1?"1 mes":s.duration_months===3?"3 meses":"12 meses"),1)]),t("div",Y,[e[19]||(e[19]=t("span",{class:"text-gatales-text-secondary"},"Suscriptores activos",-1)),t("span",Z,u(s.active_subscriptions),1)]),t("div",tt,[e[20]||(e[20]=t("span",{class:"text-gatales-text-secondary"},"Hotmart ID",-1)),t("span",et,u(s.hotmart_product_id||"-"),1)]),t("div",st,[e[21]||(e[21]=t("span",{class:"text-gatales-text-secondary"},"Offer Code",-1)),t("span",lt,u(s.hotmart_offer_code||"-"),1)])]),t("div",at,[t("button",{onClick:a=>D(s),class:"btn-secondary flex-1 text-sm"}," Editar ",8,ot),t("button",{onClick:a=>z(s),disabled:f.value===s.id||s.slug==="free",class:M(["px-3 py-2 rounded text-sm transition-colors",s.slug==="free"?"bg-gray-600/30 text-gray-500 cursor-not-allowed":"bg-red-500/20 text-red-400 hover:bg-red-500/30"])},[f.value===s.id?(d(),r("svg",it,[...e[22]||(e[22]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(d(),r("svg",rt,[...e[23]||(e[23]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},null,-1)])]))],10,nt)])],64)):(d(),r(v,{key:1},[e[32]||(e[32]=t("h3",{class:"text-lg font-semibold text-gatales-text mb-4"},"Editar Plan",-1)),t("div",dt,[t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Nombre",-1)),i(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.name=a),type:"text",class:"input-field text-sm"},null,512),[[m,o.value.name]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Tokens mensuales",-1)),i(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.tokens_monthly=a),type:"number",class:"input-field text-sm"},null,512),[[m,o.value.tokens_monthly,void 0,{number:!0}]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Precio (USD)",-1)),i(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.price=a),type:"number",step:"0.01",class:"input-field text-sm"},null,512),[[m,o.value.price,void 0,{number:!0}]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Duración",-1)),i(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.duration_months=a),class:"input-field text-sm"},[(d(),r(v,null,k(C,a=>t("option",{key:a.value,value:a.value},u(a.label),9,ut)),64))],512),[[U,o.value.duration_months,void 0,{number:!0}]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Hotmart Product ID",-1)),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.hotmart_product_id=a),type:"text",class:"input-field text-sm"},null,512),[[m,o.value.hotmart_product_id]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Hotmart Offer Code",-1)),i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.hotmart_offer_code=a),type:"text",class:"input-field text-sm font-mono",placeholder:"ej: j8kbw6d6"},null,512),[[m,o.value.hotmart_offer_code]]),e[30]||(e[30]=t("p",{class:"text-xs text-gatales-text-secondary mt-1"},"Código de oferta de Hotmart (off=xxx en la URL)",-1))]),t("div",mt,[i(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.is_active=a),type:"checkbox",id:"is_active",class:"w-4 h-4"},null,512),[[j,o.value.is_active]]),e[31]||(e[31]=t("label",{for:"is_active",class:"text-sm text-gatales-text"},"Plan activo",-1))])]),t("div",ct,[t("button",{onClick:h,class:"btn-secondary flex-1 text-sm"}," Cancelar "),t("button",{onClick:a=>H(s.id),class:"btn-primary flex-1 text-sm"}," Guardar ",8,xt)])],64))]))),128))])),_.value?(d(),r("div",vt,[t("div",ft,[e[42]||(e[42]=t("h3",{class:"text-lg font-semibold text-gatales-text mb-4"},"Nuevo Plan",-1)),t("div",pt,[t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Nombre *",-1)),i(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>n.value.name=s),type:"text",class:"input-field text-sm",placeholder:"Ej: Plan Pro"},null,512),[[m,n.value.name]])]),t("div",null,[e[34]||(e[34]=t("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Tokens mensuales",-1)),i(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>n.value.tokens_monthly=s),type:"number",class:"input-field text-sm"},null,512),[[m,n.value.tokens_monthly,void 0,{number:!0}]])]),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Precio (USD)",-1)),i(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>n.value.price=s),type:"number",step:"0.01",class:"input-field text-sm"},null,512),[[m,n.value.price,void 0,{number:!0}]])]),t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Duración",-1)),i(t("select",{"onUpdate:modelValue":e[10]||(e[10]=s=>n.value.duration_months=s),class:"input-field text-sm"},[(d(),r(v,null,k(C,s=>t("option",{key:s.value,value:s.value},u(s.label),9,bt)),64))],512),[[U,n.value.duration_months,void 0,{number:!0}]])]),t("div",null,[e[37]||(e[37]=t("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Hotmart Product ID",-1)),i(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>n.value.hotmart_product_id=s),type:"text",class:"input-field text-sm",placeholder:"Opcional"},null,512),[[m,n.value.hotmart_product_id]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Hotmart Offer Code",-1)),i(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>n.value.hotmart_offer_code=s),type:"text",class:"input-field text-sm font-mono",placeholder:"ej: j8kbw6d6"},null,512),[[m,n.value.hotmart_offer_code]]),e[39]||(e[39]=t("p",{class:"text-xs text-gatales-text-secondary mt-1"},"Código de oferta de Hotmart (off=xxx en la URL)",-1))]),t("div",yt,[i(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>n.value.is_active=s),type:"checkbox",id:"create_is_active",class:"w-4 h-4"},null,512),[[j,n.value.is_active]]),e[40]||(e[40]=t("label",{for:"create_is_active",class:"text-sm text-gatales-text"},"Plan activo",-1))])]),t("div",gt,[t("button",{onClick:P,disabled:x.value,class:"btn-secondary flex-1 text-sm"}," Cancelar ",8,_t),t("button",{onClick:S,disabled:x.value,class:"btn-primary flex-1 text-sm flex items-center justify-center gap-2"},[x.value?(d(),r("svg",wt,[...e[41]||(e[41]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):E("",!0),V(" "+u(x.value?"Creando...":"Crear Plan"),1)],8,kt)])])])):E("",!0)]))}};export{Pt as default};
