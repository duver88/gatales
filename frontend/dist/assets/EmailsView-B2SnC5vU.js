import{l as $,c as o,a as t,t as a,F as b,p as y,i as T,d as u,y as _,e as L,v as j,L as z,b as A,M as P,r as c,K as f,o as l}from"./index-DdZd5_5M.js";const U={class:"p-6"},q={key:0,class:"text-gatales-text-secondary"},H={key:1,class:"text-red-400"},K={class:"flex gap-2 mb-6 border-b border-gatales-border"},O={key:0,class:"px-1.5 py-0.5 text-xs bg-red-500/20 text-red-400 rounded-full"},Q={key:0,class:"space-y-6"},G={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},I={class:"card"},J={class:"text-2xl font-bold text-gatales-text"},W={class:"card"},X={class:"text-2xl font-bold text-green-400"},Y={class:"card"},Z={class:"text-2xl font-bold text-red-400"},tt={class:"card"},et={class:"text-2xl font-bold text-red-400"},st={class:"card"},at={class:"grid grid-cols-3 md:grid-cols-6 gap-4"},ot={class:"text-xs text-gatales-text-secondary capitalize"},lt={key:0,class:"card"},nt={class:"overflow-x-auto"},rt={class:"w-full text-sm"},dt={class:"py-2 px-3 text-gatales-text"},it={class:"py-2 px-3 text-gatales-text text-right"},ct={class:"py-2 px-3 text-green-400 text-right"},xt={class:"py-2 px-3 text-red-400 text-right"},ut={class:"py-2 px-3 text-red-400 text-right"},pt={key:1,class:"space-y-4"},gt={class:"card"},yt={class:"flex flex-wrap gap-4 items-end"},bt={class:"flex-1 min-w-[200px]"},mt={class:"w-40"},vt={class:"flex items-center gap-2 text-sm text-gatales-text-secondary"},_t={class:"card"},ft={key:0,class:"text-gatales-text-secondary text-center py-8"},ht={key:1,class:"text-gatales-text-secondary text-center py-8"},kt={key:2,class:"overflow-x-auto"},wt={class:"w-full text-sm"},Et={class:"py-2 px-3 text-gatales-text text-xs whitespace-nowrap"},Ct={class:"py-2 px-3 text-gatales-text"},Lt={key:0,class:"text-xs text-gatales-text-secondary"},St=["title"],Ft={class:"py-2 px-3 text-gatales-text-secondary text-xs capitalize"},Rt={class:"py-2 px-3"},Tt=["title"],Dt={class:"py-2 px-3"},Nt=["onClick"],Vt={key:3,class:"flex justify-center gap-2 mt-4"},Bt=["disabled"],Mt={class:"px-4 py-2 text-sm text-gatales-text-secondary"},$t=["disabled"],jt={key:2,class:"space-y-4"},zt={class:"card"},At={key:0,class:"text-gatales-text-secondary text-center py-8"},Pt={key:1,class:"overflow-x-auto"},Ut={class:"w-full text-sm"},qt={class:"py-2 px-3 text-gatales-text font-medium"},Ht={class:"py-2 px-3 text-gatales-text-secondary"},Kt={class:"py-2 px-3 text-red-400 text-center font-bold"},Ot={class:"py-2 px-3"},Qt={class:"py-2 px-3 text-gatales-text-secondary text-xs"},Gt=["title"],Wt={__name:"EmailsView",setup(It){const r=c(null),m=c([]),v=c([]),h=c(!0),k=c(!1),w=c(null),p=c("overview"),x=c({status:"",email:"",only_issues:!1}),d=c({current_page:1,last_page:1,per_page:20,total:0});async function D(){try{const n=await f.getEmailStats();r.value=n.data}catch(n){console.error("Error fetching email stats:",n),w.value="Error al cargar estadísticas"}}async function g(n=1){k.value=!0;try{const e={page:n,per_page:20,...x.value};Object.keys(e).forEach(i=>{(e[i]===""||e[i]===!1)&&delete e[i]});const s=await f.getEmailLogs(e);m.value=s.data.logs,d.value=s.data.pagination}catch(e){console.error("Error fetching logs:",e)}finally{k.value=!1}}async function N(){try{const n=await f.getBouncedEmails();v.value=n.data.bounced_emails}catch(n){console.error("Error fetching bounced emails:",n)}}async function V(n){if(confirm("¿Reenviar este correo?"))try{await f.resendEmail(n),alert("Correo marcado para reenvío"),g(d.value.current_page)}catch{alert("Error al reenviar correo")}}function E(n){p.value=n,n==="logs"&&m.value.length===0?g():n==="bounced"&&v.value.length===0&&N()}function B(){g(1)}function M(){x.value={status:"",email:"",only_issues:!1},g(1)}function S(n){return n?new Date(n).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}function C(n){return n?.toLocaleString("es-ES")||"0"}function F(n){return{pending:"bg-yellow-500/20 text-yellow-400",sent:"bg-blue-500/20 text-blue-400",delivered:"bg-green-500/20 text-green-400",bounced:"bg-red-500/20 text-red-400",failed:"bg-red-500/20 text-red-400",complained:"bg-orange-500/20 text-orange-400"}[n]||"bg-gray-500/20 text-gray-400"}const R={pending:"Pendiente",sent:"Enviado",delivered:"Entregado",bounced:"Rebotado",failed:"Fallido",complained:"Queja"};return $(async()=>{h.value=!0,await D(),h.value=!1}),(n,e)=>(l(),o("div",U,[e[24]||(e[24]=t("h1",{class:"text-2xl font-bold text-gatales-text mb-6"},"Monitoreo de Correos",-1)),h.value?(l(),o("div",q,"Cargando...")):w.value?(l(),o("div",H,a(w.value),1)):(l(),o(b,{key:2},[t("div",K,[t("button",{onClick:e[0]||(e[0]=s=>E("overview")),class:y(["px-4 py-2 text-sm font-medium transition-colors border-b-2 -mb-px",p.value==="overview"?"text-gatales-accent border-gatales-accent":"text-gatales-text-secondary border-transparent hover:text-gatales-text"])}," Resumen ",2),t("button",{onClick:e[1]||(e[1]=s=>E("logs")),class:y(["px-4 py-2 text-sm font-medium transition-colors border-b-2 -mb-px",p.value==="logs"?"text-gatales-accent border-gatales-accent":"text-gatales-text-secondary border-transparent hover:text-gatales-text"])}," Historial ",2),t("button",{onClick:e[2]||(e[2]=s=>E("bounced")),class:y(["px-4 py-2 text-sm font-medium transition-colors border-b-2 -mb-px flex items-center gap-2",p.value==="bounced"?"text-gatales-accent border-gatales-accent":"text-gatales-text-secondary border-transparent hover:text-gatales-text"])},[e[8]||(e[8]=T(" Rebotados ",-1)),r.value?.recent_bounces>0?(l(),o("span",O,a(r.value.recent_bounces),1)):u("",!0)],2)]),p.value==="overview"?(l(),o("div",Q,[t("div",G,[t("div",I,[e[9]||(e[9]=t("p",{class:"text-sm text-gatales-text-secondary"},"Total (30 días)",-1)),t("p",J,a(C(r.value?.stats?.total||0)),1)]),t("div",W,[e[10]||(e[10]=t("p",{class:"text-sm text-gatales-text-secondary"},"Entregados",-1)),t("p",X,a(r.value?.stats?.delivery_rate||0)+"%",1)]),t("div",Y,[e[11]||(e[11]=t("p",{class:"text-sm text-gatales-text-secondary"},"Tasa de Rebote",-1)),t("p",Z,a(r.value?.stats?.bounce_rate||0)+"%",1)]),t("div",tt,[e[12]||(e[12]=t("p",{class:"text-sm text-gatales-text-secondary"},"Rebotes (7 días)",-1)),t("p",et,a(C(r.value?.recent_bounces||0)),1)])]),t("div",st,[e[13]||(e[13]=t("h2",{class:"text-lg font-semibold text-gatales-text mb-4"},"Desglose por Estado",-1)),t("div",at,[(l(!0),o(b,null,_(r.value?.stats?.by_status,(s,i)=>(l(),o("div",{key:i,class:"text-center"},[t("p",{class:y(["text-2xl font-bold",F(i).split(" ")[1]])},a(C(s)),3),t("p",ot,a(R[i]||i),1)]))),128))])]),r.value?.daily?.length>0?(l(),o("div",lt,[e[15]||(e[15]=t("h2",{class:"text-lg font-semibold text-gatales-text mb-4"},"Últimos 7 Días",-1)),t("div",nt,[t("table",rt,[e[14]||(e[14]=t("thead",null,[t("tr",{class:"border-b border-gatales-border text-left"},[t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium"},"Fecha"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium text-right"},"Total"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium text-right"},"Entregados"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium text-right"},"Rebotados"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium text-right"},"Fallidos")])],-1)),t("tbody",null,[(l(!0),o(b,null,_(r.value.daily,s=>(l(),o("tr",{key:s.date,class:"border-b border-gatales-border/50 hover:bg-gatales-input/50"},[t("td",dt,a(s.date),1),t("td",it,a(s.total||0),1),t("td",ct,a(s.delivered||0),1),t("td",xt,a(s.bounced||0),1),t("td",ut,a(s.failed||0),1)]))),128))])])])])):u("",!0)])):u("",!0),p.value==="logs"?(l(),o("div",pt,[t("div",gt,[t("div",yt,[t("div",bt,[e[16]||(e[16]=t("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Correo",-1)),L(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>x.value.email=s),type:"text",placeholder:"Buscar por email...",class:"input-field"},null,512),[[j,x.value.email]])]),t("div",mt,[e[18]||(e[18]=t("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Estado",-1)),L(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>x.value.status=s),class:"input-field"},[...e[17]||(e[17]=[A('<option value="">Todos</option><option value="pending">Pendiente</option><option value="sent">Enviado</option><option value="delivered">Entregado</option><option value="bounced">Rebotado</option><option value="failed">Fallido</option>',6)])],512),[[z,x.value.status]])]),t("label",vt,[L(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=s=>x.value.only_issues=s),class:"rounded"},null,512),[[P,x.value.only_issues]]),e[19]||(e[19]=T(" Solo problemas ",-1))]),t("div",{class:"flex gap-2"},[t("button",{onClick:B,class:"btn-primary text-sm"},"Filtrar"),t("button",{onClick:M,class:"btn-secondary text-sm"},"Limpiar")])])]),t("div",_t,[k.value?(l(),o("div",ft," Cargando... ")):m.value.length===0?(l(),o("div",ht," No hay registros ")):(l(),o("div",kt,[t("table",wt,[e[20]||(e[20]=t("thead",null,[t("tr",{class:"border-b border-gatales-border text-left"},[t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium"},"Fecha"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium"},"Destinatario"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium"},"Asunto"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium"},"Tipo"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium"},"Estado"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium"},"Error"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium"})])],-1)),t("tbody",null,[(l(!0),o(b,null,_(m.value,s=>(l(),o("tr",{key:s.id,class:"border-b border-gatales-border/50 hover:bg-gatales-input/50"},[t("td",Et,a(S(s.created_at)),1),t("td",Ct,[t("div",null,a(s.to_email),1),s.to_name?(l(),o("div",Lt,a(s.to_name),1)):u("",!0)]),t("td",{class:"py-2 px-3 text-gatales-text max-w-xs truncate",title:s.subject},a(s.subject),9,St),t("td",Ft,a(s.type),1),t("td",Rt,[t("span",{class:y(["px-2 py-1 rounded text-xs",F(s.status)])},a(R[s.status]||s.status),3)]),t("td",{class:"py-2 px-3 text-red-400 text-xs max-w-xs truncate",title:s.error_message},a(s.error_message||"-"),9,Tt),t("td",Dt,[["bounced","failed"].includes(s.status)?(l(),o("button",{key:0,onClick:i=>V(s.id),class:"text-xs text-gatales-accent hover:underline"}," Reenviar ",8,Nt)):u("",!0)])]))),128))])])])),d.value.last_page>1?(l(),o("div",Vt,[t("button",{onClick:e[6]||(e[6]=s=>g(d.value.current_page-1)),disabled:d.value.current_page<=1,class:"btn-secondary text-sm disabled:opacity-50"}," Anterior ",8,Bt),t("span",Mt,a(d.value.current_page)+" / "+a(d.value.last_page),1),t("button",{onClick:e[7]||(e[7]=s=>g(d.value.current_page+1)),disabled:d.value.current_page>=d.value.last_page,class:"btn-secondary text-sm disabled:opacity-50"}," Siguiente ",8,$t)])):u("",!0)])])):u("",!0),p.value==="bounced"?(l(),o("div",jt,[t("div",zt,[e[22]||(e[22]=t("h2",{class:"text-lg font-semibold text-gatales-text mb-4"},"Correos con Problemas de Entrega",-1)),e[23]||(e[23]=t("p",{class:"text-sm text-gatales-text-secondary mb-4"}," Lista de direcciones de correo que han rebotado o fallado. Considera eliminar estas direcciones de tus listas. ",-1)),v.value.length===0?(l(),o("div",At," No hay correos rebotados ")):(l(),o("div",Pt,[t("table",Ut,[e[21]||(e[21]=t("thead",null,[t("tr",{class:"border-b border-gatales-border text-left"},[t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium"},"Correo"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium"},"Nombre"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium text-center"},"Rebotes"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium"},"Tipo"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium"},"Último rebote"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium"},"Error")])],-1)),t("tbody",null,[(l(!0),o(b,null,_(v.value,s=>(l(),o("tr",{key:s.to_email,class:"border-b border-gatales-border/50 hover:bg-gatales-input/50"},[t("td",qt,a(s.to_email),1),t("td",Ht,a(s.to_name||"-"),1),t("td",Kt,a(s.bounce_count),1),t("td",Ot,[t("span",{class:y(["px-2 py-1 rounded text-xs",s.bounce_type==="hard"?"bg-red-500/20 text-red-400":"bg-yellow-500/20 text-yellow-400"])},a(s.bounce_type||"unknown"),3)]),t("td",Qt,a(S(s.last_bounce)),1),t("td",{class:"py-2 px-3 text-red-400 text-xs max-w-xs truncate",title:s.error_message},a(s.error_message||"-"),9,Gt)]))),128))])])]))])])):u("",!0)],64))]))}};export{Wt as default};
