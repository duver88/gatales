import{l as L,x as b,c as n,a as t,e as f,L as _,F as E,y as C,d as p,t as a,p as h,K as k,r as i,o as r}from"./index-DnaU9Zpc.js";const F={class:"p-6"},S={class:"flex flex-col md:flex-row gap-4 mb-6"},V={key:0,class:"text-gatales-text-secondary"},D={key:1,class:"card overflow-x-auto"},P={class:"w-full"},W={class:"py-3 pr-4 text-sm text-gatales-text-secondary"},j={class:"py-3 pr-4 text-sm text-gatales-text"},B={class:"py-3 pr-4 text-sm text-gatales-text"},M={class:"py-3 pr-4"},N={class:"py-3"},$=["onClick"],A={key:0,class:"text-center py-8 text-gatales-text-secondary"},z={key:2,class:"flex justify-center gap-2 mt-6"},K=["disabled"],O={class:"text-gatales-text-secondary text-sm self-center"},T=["disabled"],U={key:3,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},H={class:"card w-full max-w-2xl max-h-[80vh] overflow-auto"},J={class:"flex justify-between items-start mb-4"},q={class:"space-y-3"},G={class:"flex gap-4"},I={class:"ml-2 text-gatales-text"},Q={class:"ml-2 text-gatales-text"},R={class:"ml-2 text-gatales-text"},X={key:0},Y={class:"text-red-400 text-sm bg-red-500/10 p-3 rounded"},Z={class:"bg-gatales-input p-3 rounded text-sm text-gatales-text overflow-x-auto"},at={__name:"WebhookLogsView",setup(tt){const v=i([]),x=i({}),g=i(!0),u=i(""),c=i(""),d=i(1),o=i(null);async function m(){g.value=!0;try{const l={page:d.value,per_page:20};u.value&&(l.source=u.value),c.value!==""&&(l.processed=c.value==="true");const e=await k.getWebhookLogs(l);v.value=e.data.logs,x.value=e.data.pagination}catch(l){console.error("Error fetching logs:",l)}finally{g.value=!1}}L(m),b([u,c],()=>{d.value=1,m()}),b(d,m);async function w(l){try{const e=await k.getWebhookLog(l);o.value=e.data.log}catch{alert("Error al cargar el detalle")}}function y(l){return new Date(l).toLocaleString("es-ES")}return(l,e)=>(r(),n("div",F,[e[16]||(e[16]=t("h1",{class:"text-2xl font-bold text-gatales-text mb-6"},"Webhook Logs",-1)),t("div",S,[f(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>u.value=s),class:"input-field md:w-40"},[...e[5]||(e[5]=[t("option",{value:""},"Todas las fuentes",-1),t("option",{value:"n8n"},"n8n",-1),t("option",{value:"hotmart"},"Hotmart",-1)])],512),[[_,u.value]]),f(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>c.value=s),class:"input-field md:w-40"},[...e[6]||(e[6]=[t("option",{value:""},"Todos",-1),t("option",{value:"true"},"Procesados",-1),t("option",{value:"false"},"Con errores",-1)])],512),[[_,c.value]])]),g.value?(r(),n("div",V,"Cargando...")):(r(),n("div",D,[t("table",P,[e[7]||(e[7]=t("thead",null,[t("tr",{class:"text-left text-sm text-gatales-text-secondary border-b border-gatales-border"},[t("th",{class:"pb-3 pr-4"},"Fecha"),t("th",{class:"pb-3 pr-4"},"Fuente"),t("th",{class:"pb-3 pr-4"},"Evento"),t("th",{class:"pb-3 pr-4"},"Estado"),t("th",{class:"pb-3"},"Acciones")])],-1)),t("tbody",null,[(r(!0),n(E,null,C(v.value,s=>(r(),n("tr",{key:s.id,class:"border-b border-gatales-border/50"},[t("td",W,a(y(s.created_at)),1),t("td",j,a(s.source),1),t("td",B,a(s.event_type),1),t("td",M,[t("span",{class:h(["px-2 py-1 rounded text-xs",s.processed?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"])},a(s.processed?"OK":"Error"),3)]),t("td",N,[t("button",{onClick:et=>w(s.id),class:"text-gatales-accent hover:underline text-sm"}," Ver detalle ",8,$)])]))),128))])]),v.value.length===0?(r(),n("div",A," No se encontraron logs ")):p("",!0)])),x.value.last_page>1?(r(),n("div",z,[t("button",{onClick:e[2]||(e[2]=s=>d.value--),disabled:d.value===1,class:"btn-secondary px-3 py-1 text-sm"}," Anterior ",8,K),t("span",O," PÃ¡gina "+a(d.value)+" de "+a(x.value.last_page),1),t("button",{onClick:e[3]||(e[3]=s=>d.value++),disabled:d.value===x.value.last_page,class:"btn-secondary px-3 py-1 text-sm"}," Siguiente ",8,T)])):p("",!0),o.value?(r(),n("div",U,[t("div",H,[t("div",J,[e[9]||(e[9]=t("h3",{class:"text-lg font-semibold text-gatales-text"},"Detalle del Webhook",-1)),t("button",{onClick:e[4]||(e[4]=s=>o.value=null),class:"text-gatales-text-secondary hover:text-gatales-text"},[...e[8]||(e[8]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",q,[t("div",G,[t("div",null,[e[10]||(e[10]=t("span",{class:"text-sm text-gatales-text-secondary"},"Fuente:",-1)),t("span",I,a(o.value.source),1)]),t("div",null,[e[11]||(e[11]=t("span",{class:"text-sm text-gatales-text-secondary"},"Evento:",-1)),t("span",Q,a(o.value.event_type),1)])]),t("div",null,[e[12]||(e[12]=t("span",{class:"text-sm text-gatales-text-secondary"},"Fecha:",-1)),t("span",R,a(y(o.value.created_at)),1)]),t("div",null,[e[13]||(e[13]=t("span",{class:"text-sm text-gatales-text-secondary"},"Estado:",-1)),t("span",{class:h(["ml-2 px-2 py-1 rounded text-xs",o.value.processed?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"])},a(o.value.processed?"Procesado correctamente":"Error"),3)]),o.value.error?(r(),n("div",X,[e[14]||(e[14]=t("p",{class:"text-sm text-gatales-text-secondary mb-1"},"Error:",-1)),t("p",Y,a(o.value.error),1)])):p("",!0),t("div",null,[e[15]||(e[15]=t("p",{class:"text-sm text-gatales-text-secondary mb-1"},"Payload:",-1)),t("pre",Z,a(JSON.stringify(o.value.payload,null,2)),1)])])])])):p("",!0)]))}};export{at as default};
