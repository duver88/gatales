import{l as se,x as U,K as k,c as o,a as e,F as L,y as N,i as T,d as _,t as r,b as O,w as P,e as ae,v as oe,r as x,q,o as n,p as b,B as ne}from"./index-DnaU9Zpc.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"h-full flex"},re={class:"w-64 bg-gatales-sidebar border-r border-gatales-border flex flex-col shrink-0"},ue={class:"flex-1 overflow-y-auto p-3 space-y-2"},ce={key:0,class:"flex justify-center py-8"},de=["onClick"],pe={class:"flex items-center gap-3"},ve={class:"flex-1 min-w-0"},ge={class:"font-medium truncate text-sm"},xe={class:"mt-2 flex items-center gap-2 text-xs"},fe={class:"w-56 bg-gatales-bg border-r border-gatales-border flex flex-col shrink-0"},me={class:"p-3 border-b border-gatales-border"},he=["disabled"],_e={class:"flex-1 overflow-y-auto"},ye={key:0,class:"flex justify-center py-8"},be={key:1,class:"p-4 text-center"},ke={key:2,class:"py-2 px-2 space-y-1"},we=["onClick"],Ce={class:"flex-1 min-w-0"},Me={class:"text-xs truncate"},Te={class:"text-[10px] text-gatales-text-secondary"},Ae={class:"text-[10px] text-gatales-text-secondary shrink-0 group-hover:hidden"},Se=["onClick"],je={key:0,class:"p-2 border-t border-gatales-border"},Be={class:"flex-1 flex flex-col min-w-0"},De={class:"p-4 border-b border-gatales-border flex items-center justify-between bg-gatales-sidebar"},Ee={key:0,class:"flex items-center gap-3"},Ie={class:"w-10 h-10 rounded-full bg-gatales-accent flex items-center justify-center text-white text-lg shrink-0"},Le={class:"min-w-0"},ze={class:"font-semibold text-gatales-text truncate"},Ve={class:"text-sm text-gatales-text-secondary"},$e={key:1,class:"text-gatales-text-secondary"},Ne={class:"flex items-center gap-2 shrink-0"},He={key:0,class:"text-xs bg-gatales-accent/10 text-gatales-accent px-2 py-1 rounded-lg"},Ke={class:"text-green-400 ml-1"},Fe={key:1,class:"text-xs text-gatales-text-secondary bg-gatales-input px-2 py-1 rounded-lg"},Ue={class:"text-green-400 ml-1"},Oe={key:0,class:"h-full flex items-center justify-center"},Pe={class:"text-center max-w-md"},qe={class:"w-16 h-16 rounded-full bg-gatales-accent/20 flex items-center justify-center text-gatales-accent text-2xl mx-auto mb-4"},Ge={class:"text-lg font-semibold text-gatales-text mb-2"},Re={class:"text-gatales-text-secondary mb-4"},Je={class:"bg-gatales-input rounded-lg p-3 text-left text-sm"},Qe={class:"space-y-1 text-gatales-text"},We={key:0},Xe={key:1,class:"h-full flex items-center justify-center"},Ye={key:0,class:"thinking-indicator"},Ze={key:1,class:"message-content"},et=["innerHTML"],tt={key:0,class:"streaming-cursor"},st={key:0,class:"px-1.5 py-0.5 bg-gatales-accent/20 text-gatales-accent rounded text-[10px]"},at={key:0,class:"flex justify-start"},ot={class:"p-4 border-t border-gatales-border bg-gatales-sidebar"},nt=["disabled"],lt=["disabled"],it={key:0},rt={key:1,class:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24"},ut={key:2,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ct={__name:"AdminChatView",setup(dt){const A=x([]),u=x(null),i=x([]),w=x(""),y=x(!1),D=x(!0),E=x(null),p=x({prompt:0,completion:0,total:0,cost:0}),m=x({input:0,output:0,cost:0}),H={"gpt-5.2":{input:5,output:15},"gpt-5.2-mini":{input:.3,output:1.2},"gpt-5.2-codex":{input:3,output:12},"gpt-5.1":{input:4,output:12},"gpt-5.1-mini":{input:.25,output:1},"gpt-5.1-codex":{input:2.5,output:10},"gpt-5":{input:3,output:10},"gpt-5-mini":{input:.2,output:.8},"gpt-4o":{input:2.5,output:10},"gpt-4o-mini":{input:.15,output:.6},"gpt-4-turbo":{input:10,output:30},"gpt-4":{input:30,output:60},"gpt-3.5-turbo":{input:.5,output:1.5},o1:{input:15,output:60},"o1-mini":{input:3,output:12},"deepseek-chat":{input:.14,output:.28},"deepseek-reasoner":{input:.55,output:2.19}};function K(a,t,s){const d=H[a]||H["gpt-4o-mini"],l=t/1e6*d.input,v=s/1e6*d.output;return l+v}const f=x([]),h=x(null),z=x(!1),I=x(!1),S=x(!1),C=x(!1),c=q(()=>A.value.find(a=>a.id===u.value)),V=q(()=>u.value?f.value.filter(a=>a.assistant_id===u.value):[]);se(async()=>{await G()}),U(u,async a=>{a&&await R(a)}),U(()=>i.value.length,()=>{M()});async function G(){D.value=!0;try{const a=await k.getAssistants();A.value=a.data.assistants||a.data.data||[],A.value.length>0&&!u.value&&(u.value=A.value[0].id)}catch(a){console.error("Error loading assistants:",a)}finally{D.value=!1}}async function R(a){z.value=!0;try{const t=await k.getTestConversations(a);f.value=t.data.conversations||[],f.value.length>0?await $(f.value[0].id):(h.value=null,i.value=[],p.value={prompt:0,completion:0,total:0,cost:0},m.value={input:0,output:0,cost:0})}catch(t){console.error("Error loading test conversations:",t),f.value=[]}finally{z.value=!1}}function J(a){a!==u.value&&(u.value=a,h.value=null,i.value=[],p.value={prompt:0,completion:0,total:0,cost:0},m.value={input:0,output:0,cost:0})}async function $(a){if(a!==h.value){h.value=a,i.value=[],p.value={prompt:0,completion:0,total:0,cost:0},m.value={input:0,output:0,cost:0};try{const t=await k.getTestConversation(a),s=t.data.conversation,d=t.data.messages||[];i.value=d.map(B=>({id:B.id,role:B.role,content:B.content,timestamp:new Date(B.created_at),usedKnowledgeBase:B.used_knowledge_base||!1}));const l=s.total_tokens_input||0,v=s.total_tokens_output||0,g=c.value?.model||"gpt-4o-mini",j=K(g,l,v);p.value={prompt:l,completion:v,total:l+v,cost:j},M()}catch(t){console.error("Error loading conversation:",t)}}}async function F(){if(!(!u.value||I.value)){I.value=!0;try{const t=(await k.createTestConversation(u.value)).data.conversation;f.value.unshift(t),h.value=t.id,i.value=[],p.value={prompt:0,completion:0,total:0,cost:0},m.value={input:0,output:0,cost:0}}catch(a){console.error("Error creating conversation:",a)}finally{I.value=!1}}}async function Q(a){if(confirm("Eliminar esta conversacion de prueba?"))try{await k.deleteTestConversation(a),f.value=f.value.filter(t=>t.id!==a),h.value===a&&(f.value.length>0?await $(f.value[0].id):(h.value=null,i.value=[],p.value={prompt:0,completion:0,total:0,cost:0},m.value={input:0,output:0,cost:0}))}catch(t){console.error("Error deleting conversation:",t)}}async function W(){if(u.value&&confirm("Eliminar TODAS las conversaciones de prueba de este asistente?"))try{await k.clearAllTestConversations(u.value),f.value=[],h.value=null,i.value=[],p.value={prompt:0,completion:0,total:0,cost:0},m.value={input:0,output:0,cost:0}}catch(a){console.error("Error clearing conversations:",a)}}async function X(){if(!w.value.trim()||y.value||!u.value)return;h.value||await F();const a=w.value.trim();w.value="";const t={id:Date.now(),role:"user",content:a,timestamp:new Date};i.value.push(t);const s=Date.now()+1,d={id:s,role:"assistant",content:"",timestamp:new Date,isStreaming:!0,isThinking:!0};i.value.push(d),M(),y.value=!0,C.value=!0,S.value=!1,k.sendTestConversationMessageStream(h.value,a,l=>{if(!l||l.length===0)return;if(C.value){C.value=!1,S.value=!0;const g=i.value.findIndex(j=>j.id===s);g!==-1&&(i.value[g].isThinking=!1)}const v=i.value.findIndex(g=>g.id===s);v!==-1&&(i.value[v].content+=l),M()},l=>{y.value=!1,C.value=!1,S.value=!1;const v=i.value.findIndex(g=>g.id===s);if(v!==-1&&(i.value[v].id=l.message_id,i.value[v].isStreaming=!1,i.value[v].isThinking=!1),l.tokens_input!==void 0&&l.tokens_output!==void 0){const g=K(l.model||c.value?.model,l.tokens_input,l.tokens_output);m.value={input:l.tokens_input,output:l.tokens_output,cost:g},p.value.prompt+=l.tokens_input,p.value.completion+=l.tokens_output,p.value.total+=l.tokens_input+l.tokens_output,p.value.cost+=g}else l.tokens_used&&(p.value.total+=l.tokens_used);if(l.conversation){const g=f.value.findIndex(j=>j.id===h.value);g>=0&&(f.value[g]={...f.value[g],...l.conversation})}M()},l=>{y.value=!1,C.value=!1,S.value=!1,i.value=i.value.filter(v=>v.id!==t.id&&v.id!==s),i.value.push({id:Date.now()+2,role:"error",content:l.message||"Error al enviar el mensaje",timestamp:new Date}),M()})}function M(){ne(()=>{E.value&&(E.value.scrollTop=E.value.scrollHeight)})}function Y(a){return new Date(a).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})}function Z(a){if(!a)return"";const t=new Date(a),d=new Date-t;return d<6e4?"Ahora":d<36e5?`${Math.floor(d/6e4)}m`:d<864e5?`${Math.floor(d/36e5)}h`:t.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}function ee(a,t=30){return a?a.length>t?a.substring(0,t)+"...":a:"Nueva prueba"}function te(a){return a?a.replace(/\*\*([\s\S]+?)\*\*/g,"<strong>$1</strong>").replace(/\*(?!\*)([\s\S]+?)\*(?!\*)/g,"<em>$1</em>").replace(/`([^`]+)`/g,'<code class="bg-gatales-bg px-1 py-0.5 rounded text-sm">$1</code>').replace(/\n/g,"<br>"):""}return(a,t)=>(n(),o("div",ie,[e("div",re,[t[2]||(t[2]=e("div",{class:"p-4 border-b border-gatales-border"},[e("h2",{class:"text-lg font-semibold text-gatales-text"},"Asistentes"),e("p",{class:"text-sm text-gatales-text-secondary mt-1"},"Selecciona uno para probar")],-1)),e("div",ue,[D.value?(n(),o("div",ce,[...t[1]||(t[1]=[e("svg",{class:"animate-spin h-6 w-6 text-gatales-accent",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):(n(!0),o(L,{key:1},N(A.value,s=>(n(),o("button",{key:s.id,onClick:d=>J(s.id),class:b(["w-full text-left p-3 rounded-lg transition-colors",u.value===s.id?"bg-gatales-accent text-white":"bg-gatales-input text-gatales-text hover:bg-gatales-border"])},[e("div",pe,[e("div",{class:b(["w-10 h-10 rounded-full flex items-center justify-center text-lg shrink-0",u.value===s.id?"bg-white/20":"bg-gatales-accent/20"])},r(s.assistant_display_name?.charAt(0)||s.name?.charAt(0)||"?"),3),e("div",ve,[e("p",ge,r(s.assistant_display_name||s.name),1),e("p",{class:b(["text-xs truncate",u.value===s.id?"text-white/70":"text-gatales-text-secondary"])},r(s.model),3)])]),e("div",xe,[s.use_knowledge_base?(n(),o("span",{key:0,class:b(["px-2 py-0.5 rounded",u.value===s.id?"bg-white/20":"bg-gatales-accent/20 text-gatales-accent"])}," KB ",2)):_("",!0),s.is_default?(n(),o("span",{key:1,class:b(["px-2 py-0.5 rounded",u.value===s.id?"bg-white/20":"bg-green-500/20 text-green-400"])}," Default ",2)):_("",!0)])],10,de))),128))])]),e("div",fe,[e("div",me,[e("button",{onClick:F,disabled:!u.value||I.value,class:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-gatales-accent hover:bg-gatales-accent-hover text-white rounded-lg text-sm font-medium transition-colors disabled:opacity-50"},[...t[3]||(t[3]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),T(" Nueva prueba ",-1)])],8,he)]),e("div",_e,[z.value?(n(),o("div",ye,[...t[4]||(t[4]=[e("svg",{class:"animate-spin h-5 w-5 text-gatales-accent",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):V.value.length===0&&u.value?(n(),o("div",be,[...t[5]||(t[5]=[e("p",{class:"text-gatales-text-secondary text-sm"},"No hay pruebas aun",-1),e("p",{class:"text-gatales-text-secondary text-xs mt-1"},"Crea una nueva para comenzar",-1)])])):(n(),o("div",ke,[(n(!0),o(L,null,N(V.value,s=>(n(),o("div",{key:s.id,onClick:d=>$(s.id),class:b(["group relative flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer transition-colors",h.value===s.id?"bg-gatales-accent/10 text-gatales-accent":"hover:bg-gatales-input text-gatales-text"])},[t[7]||(t[7]=e("svg",{class:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})],-1)),e("div",Ce,[e("p",Me,r(ee(s.title)),1),e("p",Te,r((s.total_tokens_input||0)+(s.total_tokens_output||0))+" tokens ",1)]),e("span",Ae,r(Z(s.last_message_at||s.created_at)),1),e("button",{onClick:P(d=>Q(s.id),["stop"]),class:"hidden group-hover:block p-1 rounded hover:bg-red-500/20 text-red-400 transition-colors"},[...t[6]||(t[6]=[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Se)],10,we))),128))]))]),V.value.length>0?(n(),o("div",je,[e("button",{onClick:W,class:"w-full text-xs text-gatales-text-secondary hover:text-red-400 py-1.5 transition-colors"}," Limpiar historial ")])):_("",!0)]),e("div",Be,[e("div",De,[c.value?(n(),o("div",Ee,[e("div",Ie,r(c.value.assistant_display_name?.charAt(0)||c.value.name?.charAt(0)||"?"),1),e("div",Le,[e("h3",ze,r(c.value.assistant_display_name||c.value.name),1),e("p",Ve,r(c.value.model)+" ¬∑ Temp: "+r(c.value.temperature),1)])])):(n(),o("div",$e," Selecciona un asistente ")),e("div",Ne,[m.value.input>0||m.value.output>0?(n(),o("div",He,[t[8]||(t[8]=e("span",{class:"font-medium"},"Ultimo:",-1)),T(" "+r(m.value.input.toLocaleString())+" in / "+r(m.value.output.toLocaleString())+" out ",1),e("span",Ke,"$"+r(m.value.cost.toFixed(4)),1)])):_("",!0),p.value.total>0?(n(),o("div",Fe,[t[9]||(t[9]=e("span",{class:"text-gatales-text font-medium"},"Total:",-1)),T(" "+r(p.value.prompt.toLocaleString())+" in / "+r(p.value.completion.toLocaleString())+" out ",1),e("span",Ue,"$"+r(p.value.cost.toFixed(4)),1)])):_("",!0)])]),e("div",{ref_key:"messagesContainer",ref:E,class:"flex-1 overflow-y-auto p-4 space-y-4"},[i.value.length===0&&c.value?(n(),o("div",Oe,[e("div",Pe,[e("div",qe,r(c.value.assistant_display_name?.charAt(0)||c.value.name?.charAt(0)||"?"),1),e("h3",Ge," Probando: "+r(c.value.assistant_display_name||c.value.name),1),e("p",Re,r(c.value.welcome_message||"Escribe un mensaje para probar este asistente."),1),e("div",Je,[t[14]||(t[14]=e("p",{class:"text-gatales-text-secondary mb-2"},"Configuracion:",-1)),e("ul",Qe,[e("li",null,[t[10]||(t[10]=e("span",{class:"text-gatales-text-secondary"},"Modelo:",-1)),T(" "+r(c.value.model),1)]),e("li",null,[t[11]||(t[11]=e("span",{class:"text-gatales-text-secondary"},"Temperatura:",-1)),T(" "+r(c.value.temperature),1)]),e("li",null,[t[12]||(t[12]=e("span",{class:"text-gatales-text-secondary"},"Max tokens:",-1)),T(" "+r(c.value.max_tokens),1)]),c.value.use_knowledge_base?(n(),o("li",We,[...t[13]||(t[13]=[e("span",{class:"text-gatales-accent"},"Base de conocimiento activa",-1)])])):_("",!0)])])])])):!c.value&&!D.value?(n(),o("div",Xe,[...t[15]||(t[15]=[e("div",{class:"text-center"},[e("svg",{class:"w-16 h-16 text-gatales-text-secondary mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})]),e("p",{class:"text-gatales-text-secondary"},"Selecciona un asistente de la lista")],-1)])])):(n(),o(L,{key:2},[(n(!0),o(L,null,N(i.value,(s,d)=>(n(),o("div",{key:s.id||d,class:b(["flex",s.role==="user"?"justify-end":"justify-start"])},[e("div",{class:b(["max-w-[80%] rounded-2xl px-4 py-2.5",s.role==="user"?"bg-gatales-accent text-white rounded-br-md":s.role==="error"?"bg-red-500/20 text-red-400 rounded-bl-md":"bg-gatales-input text-gatales-text rounded-bl-md"])},[s.isThinking?(n(),o("div",Ye,[...t[16]||(t[16]=[O('<span class="thinking-icon" data-v-d638af87>üç≥</span><span class="thinking-text" data-v-d638af87>Cocinando respuesta</span><span class="thinking-dots" data-v-d638af87><span class="dot" data-v-d638af87>.</span><span class="dot" data-v-d638af87>.</span><span class="dot" data-v-d638af87>.</span></span>',3)])])):(n(),o("div",Ze,[e("span",{innerHTML:te(s.content)},null,8,et),s.isStreaming?(n(),o("span",tt,"|")):_("",!0)])),e("div",{class:b(["flex items-center gap-2 text-xs mt-1",s.role==="user"?"text-white/60":"text-gatales-text-secondary"])},[e("span",null,r(Y(s.timestamp)),1),s.usedKnowledgeBase?(n(),o("span",st," KB ")):_("",!0)],2)],2)],2))),128)),y.value&&!S.value&&!C.value?(n(),o("div",at,[...t[17]||(t[17]=[O('<div class="bg-gatales-input rounded-2xl rounded-bl-md px-4 py-3" data-v-d638af87><div class="flex items-center gap-1" data-v-d638af87><span class="w-2 h-2 bg-gatales-accent rounded-full animate-bounce" style="animation-delay:0ms;" data-v-d638af87></span><span class="w-2 h-2 bg-gatales-accent rounded-full animate-bounce" style="animation-delay:150ms;" data-v-d638af87></span><span class="w-2 h-2 bg-gatales-accent rounded-full animate-bounce" style="animation-delay:300ms;" data-v-d638af87></span></div></div>',1)])])):_("",!0)],64))],512),e("div",ot,[e("form",{onSubmit:P(X,["prevent"]),class:"flex gap-3"},[ae(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>w.value=s),type:"text",placeholder:"Escribe un mensaje para probar...",disabled:y.value||!u.value,class:"flex-1 bg-gatales-input border border-gatales-border rounded-xl px-4 py-3 text-gatales-text placeholder-gatales-text-secondary focus:outline-none focus:ring-2 focus:ring-gatales-accent focus:border-transparent disabled:opacity-50"},null,8,nt),[[oe,w.value]]),e("button",{type:"submit",disabled:y.value||!w.value.trim()||!u.value,class:"px-6 py-3 bg-gatales-accent text-white rounded-xl font-medium hover:bg-gatales-accent-hover disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2"},[y.value?_("",!0):(n(),o("span",it,"Enviar")),y.value?(n(),o("svg",rt,[...t[18]||(t[18]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(n(),o("svg",ut,[...t[19]||(t[19]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1)])]))],8,lt)],32)])])]))}},gt=le(ct,[["__scopeId","data-v-d638af87"]]);export{gt as default};
