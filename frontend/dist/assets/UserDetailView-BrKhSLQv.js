import{l as j,c as o,a as t,i as M,h as V,t as s,F as y,d as u,p as I,y as C,e as D,v as L,L as N,K as c,k as B,r as x,q as O,m as R,o as l}from"./index-DdZd5_5M.js";const z={class:"p-6"},q={key:0,class:"text-gatales-text-secondary"},H={key:1,class:"text-red-400"},K={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6"},G={class:"text-2xl font-bold text-gatales-text"},J={class:"text-gatales-text-secondary"},Q={class:"flex gap-2"},W={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8"},X={class:"card"},Y={class:"card"},Z={class:"text-xl font-bold text-gatales-text mt-1"},tt={class:"card"},et={class:"text-xl font-bold text-gatales-text mt-1"},st={key:0,class:"card mb-8"},at={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},ot={class:"text-gatales-text font-medium"},lt={class:"text-gatales-text font-medium"},nt={class:"text-gatales-text font-medium"},dt={class:"text-gatales-text font-medium"},it={key:1,class:"card mb-8"},rt={class:"mb-6"},xt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ut={class:"bg-gradient-to-br from-green-500/10 to-green-600/5 border border-green-500/20 rounded-lg p-4"},ct={class:"grid grid-cols-2 gap-2 text-sm"},gt={class:"text-gatales-text font-medium"},mt={class:"text-green-400 font-bold"},pt={class:"bg-gradient-to-br from-blue-500/10 to-blue-600/5 border border-blue-500/20 rounded-lg p-4"},vt={class:"grid grid-cols-2 gap-2 text-sm"},bt={class:"text-gatales-text font-medium"},_t={class:"text-blue-400 font-bold"},yt={class:"bg-gatales-input rounded-lg p-4"},ft={class:"grid grid-cols-2 gap-2 text-sm"},kt={class:"text-gatales-text font-medium"},ht={class:"text-amber-400 font-bold"},Ct={class:"mb-6"},wt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Tt={class:"bg-gradient-to-br from-green-500/10 to-green-600/5 border border-green-500/20 rounded-lg p-4"},Dt={class:"grid grid-cols-2 gap-2 text-sm"},St={class:"text-gatales-text font-medium"},Ut={class:"text-green-400 font-bold"},$t={class:"bg-gradient-to-br from-blue-500/10 to-blue-600/5 border border-blue-500/20 rounded-lg p-4"},Ft={class:"grid grid-cols-2 gap-2 text-sm"},Et={class:"text-gatales-text font-medium"},At={class:"text-blue-400 font-bold"},Pt={class:"bg-gatales-input rounded-lg p-4"},jt={class:"grid grid-cols-2 gap-2 text-sm"},Mt={class:"text-gatales-text font-medium"},Vt={class:"text-amber-400 font-bold"},It={key:0},Lt={class:"overflow-x-auto"},Nt={class:"w-full text-sm"},Bt={class:"py-2 px-3 text-gatales-text"},Ot={class:"py-2 px-3 text-gatales-text text-right"},Rt={class:"py-2 px-3 text-green-400 text-right"},zt={class:"py-2 px-3 text-gatales-text text-right"},qt={class:"py-2 px-3 text-blue-400 text-right"},Ht={class:"py-2 px-3 text-gatales-text font-medium text-right"},Kt={class:"py-2 px-3 text-amber-400 font-bold text-right"},Gt={key:1,class:"text-gatales-text-secondary text-sm"},Jt={class:"card mb-8"},Qt={class:"text-lg font-semibold text-gatales-text mb-4"},Wt={key:0,class:"text-gatales-text-secondary text-sm"},Xt={key:1,class:"overflow-x-auto"},Yt={class:"w-full text-sm"},Zt=["title"],te={class:"py-2 px-3 text-gatales-text text-center"},ee={class:"py-2 px-3 text-gatales-text text-right"},se={class:"py-2 px-3 text-gatales-text text-right"},ae={class:"py-2 px-3 text-gatales-text font-medium text-right"},oe={class:"py-2 px-3 text-green-400 text-right"},le={class:"py-2 px-3 text-gatales-text-secondary text-right text-xs"},ne={key:3,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},de={class:"card w-full max-w-md mx-4"},ie={class:"flex gap-2 justify-end"},re={key:4,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},xe={class:"card w-full max-w-md mx-4"},ue=["value"],ce={class:"flex gap-2 justify-end"},pe={__name:"UserDetailView",setup(ge){const S=R(),U=B(),n=x(null),m=x([]),i=x([]),w=x([]),f=x(!0),k=x(null),p=x(!1),v=x(!1),b=x(1e4),_=x(null),g=O(()=>S.params.id);async function T(){f.value=!0;try{const[d,e]=await Promise.all([c.getUser(g.value),c.getPlans()]);n.value=d.data.user,m.value=d.data.conversations||[],i.value=d.data.token_stats,w.value=e.data.plans,_.value=n.value.subscription?.plan_id}catch{k.value="Error al cargar el usuario"}finally{f.value=!1}}j(T);async function $(){try{await c.activateUser(g.value),n.value.status="active"}catch{alert("Error al activar el usuario")}}async function F(){if(confirm("¿Estás seguro de desactivar este usuario?"))try{await c.deactivateUser(g.value),n.value.status="inactive"}catch{alert("Error al desactivar el usuario")}}async function E(){try{const d=await c.addTokens(g.value,b.value);n.value.tokens_balance=d.data.tokens_balance,p.value=!1,b.value=1e4}catch{alert("Error al agregar tokens")}}async function A(){try{await c.changePlan(g.value,{plan_id:_.value,reset_tokens:!0}),await T(),v.value=!1}catch{alert("Error al cambiar el plan")}}function r(d){return d?.toLocaleString("es-ES")||"0"}function h(d){return d?new Date(d).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}function P(d){const e={active:"bg-green-500/20 text-green-400",pending:"bg-yellow-500/20 text-yellow-400",inactive:"bg-red-500/20 text-red-400",suspended:"bg-gray-500/20 text-gray-400"};return e[d]||e.inactive}return(d,e)=>(l(),o("div",z,[t("button",{onClick:e[0]||(e[0]=a=>V(U).push("/admin/users")),class:"flex items-center gap-2 text-gatales-text-secondary hover:text-gatales-text mb-4"},[...e[7]||(e[7]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),M(" Volver a usuarios ",-1)])]),f.value?(l(),o("div",q,"Cargando...")):k.value?(l(),o("div",H,s(k.value),1)):n.value?(l(),o(y,{key:2},[t("div",K,[t("div",null,[t("h1",G,s(n.value.name),1),t("p",J,s(n.value.email),1)]),t("div",Q,[n.value.status!=="active"?(l(),o("button",{key:0,onClick:$,class:"btn-primary text-sm"}," Activar ")):u("",!0),n.value.status==="active"?(l(),o("button",{key:1,onClick:F,class:"btn-secondary text-sm"}," Desactivar ")):u("",!0),t("button",{onClick:e[1]||(e[1]=a=>p.value=!0),class:"btn-secondary text-sm"}," Agregar tokens "),t("button",{onClick:e[2]||(e[2]=a=>v.value=!0),class:"btn-secondary text-sm"}," Cambiar plan ")])]),t("div",W,[t("div",X,[e[8]||(e[8]=t("p",{class:"text-sm text-gatales-text-secondary"},"Estado",-1)),t("span",{class:I(["inline-block mt-1 px-2 py-1 rounded text-sm",P(n.value.status)])},s(n.value.status),3)]),t("div",Y,[e[9]||(e[9]=t("p",{class:"text-sm text-gatales-text-secondary"},"Tokens Disponibles",-1)),t("p",Z,s(r(n.value.tokens_balance)),1)]),t("div",tt,[e[10]||(e[10]=t("p",{class:"text-sm text-gatales-text-secondary"},"Tokens Usados Este Mes",-1)),t("p",et,s(r(n.value.tokens_used_month)),1)])]),n.value.subscription?(l(),o("div",st,[e[15]||(e[15]=t("h2",{class:"text-lg font-semibold text-gatales-text mb-4"},"Suscripción Activa",-1)),t("div",at,[t("div",null,[e[11]||(e[11]=t("p",{class:"text-sm text-gatales-text-secondary"},"Plan",-1)),t("p",ot,s(n.value.subscription.plan),1)]),t("div",null,[e[12]||(e[12]=t("p",{class:"text-sm text-gatales-text-secondary"},"Estado",-1)),t("p",lt,s(n.value.subscription.status),1)]),t("div",null,[e[13]||(e[13]=t("p",{class:"text-sm text-gatales-text-secondary"},"Inicio",-1)),t("p",nt,s(h(n.value.subscription.starts_at)),1)]),t("div",null,[e[14]||(e[14]=t("p",{class:"text-sm text-gatales-text-secondary"},"Vence",-1)),t("p",dt,s(h(n.value.subscription.ends_at)),1)])])])):u("",!0),i.value?(l(),o("div",it,[e[38]||(e[38]=t("h2",{class:"text-lg font-semibold text-gatales-text mb-4"},"Consumo de Tokens por Proveedor",-1)),t("div",rt,[e[25]||(e[25]=t("h3",{class:"text-sm font-medium text-gatales-text-secondary mb-3"},"Totales Históricos",-1)),t("div",xt,[t("div",ut,[e[18]||(e[18]=t("div",{class:"flex items-center gap-2 mb-2"},[t("span",{class:"text-green-400 font-semibold"},"OpenAI")],-1)),t("div",ct,[t("div",null,[e[16]||(e[16]=t("p",{class:"text-gatales-text-secondary text-xs"},"Tokens",-1)),t("p",gt,s(r(i.value.all_time_totals?.openai?.total||0)),1)]),t("div",null,[e[17]||(e[17]=t("p",{class:"text-gatales-text-secondary text-xs"},"Costo USD",-1)),t("p",mt,"$"+s((i.value.all_time_totals?.openai?.cost||0).toFixed(4)),1)])])]),t("div",pt,[e[21]||(e[21]=t("div",{class:"flex items-center gap-2 mb-2"},[t("span",{class:"text-blue-400 font-semibold"},"DeepSeek")],-1)),t("div",vt,[t("div",null,[e[19]||(e[19]=t("p",{class:"text-gatales-text-secondary text-xs"},"Tokens",-1)),t("p",bt,s(r(i.value.all_time_totals?.deepseek?.total||0)),1)]),t("div",null,[e[20]||(e[20]=t("p",{class:"text-gatales-text-secondary text-xs"},"Costo USD",-1)),t("p",_t,"$"+s((i.value.all_time_totals?.deepseek?.cost||0).toFixed(4)),1)])])]),t("div",yt,[e[24]||(e[24]=t("div",{class:"flex items-center gap-2 mb-2"},[t("span",{class:"text-gatales-text font-semibold"},"Total")],-1)),t("div",ft,[t("div",null,[e[22]||(e[22]=t("p",{class:"text-gatales-text-secondary text-xs"},"Tokens",-1)),t("p",kt,s(r(i.value.all_time_totals?.total||0)),1)]),t("div",null,[e[23]||(e[23]=t("p",{class:"text-gatales-text-secondary text-xs"},"Costo USD",-1)),t("p",ht,"$"+s((i.value.all_time_totals?.total_cost||0).toFixed(4)),1)])])])])]),t("div",Ct,[e[35]||(e[35]=t("h3",{class:"text-sm font-medium text-gatales-text-secondary mb-3"},"Últimos 30 Días",-1)),t("div",wt,[t("div",Tt,[e[28]||(e[28]=t("div",{class:"flex items-center gap-2 mb-2"},[t("span",{class:"text-green-400 font-semibold"},"OpenAI")],-1)),t("div",Dt,[t("div",null,[e[26]||(e[26]=t("p",{class:"text-gatales-text-secondary text-xs"},"Tokens",-1)),t("p",St,s(r(i.value.period_totals?.openai?.total||0)),1)]),t("div",null,[e[27]||(e[27]=t("p",{class:"text-gatales-text-secondary text-xs"},"Costo USD",-1)),t("p",Ut,"$"+s((i.value.period_totals?.openai?.cost||0).toFixed(4)),1)])])]),t("div",$t,[e[31]||(e[31]=t("div",{class:"flex items-center gap-2 mb-2"},[t("span",{class:"text-blue-400 font-semibold"},"DeepSeek")],-1)),t("div",Ft,[t("div",null,[e[29]||(e[29]=t("p",{class:"text-gatales-text-secondary text-xs"},"Tokens",-1)),t("p",Et,s(r(i.value.period_totals?.deepseek?.total||0)),1)]),t("div",null,[e[30]||(e[30]=t("p",{class:"text-gatales-text-secondary text-xs"},"Costo USD",-1)),t("p",At,"$"+s((i.value.period_totals?.deepseek?.cost||0).toFixed(4)),1)])])]),t("div",Pt,[e[34]||(e[34]=t("div",{class:"flex items-center gap-2 mb-2"},[t("span",{class:"text-gatales-text font-semibold"},"Total")],-1)),t("div",jt,[t("div",null,[e[32]||(e[32]=t("p",{class:"text-gatales-text-secondary text-xs"},"Tokens",-1)),t("p",Mt,s(r(i.value.period_totals?.total||0)),1)]),t("div",null,[e[33]||(e[33]=t("p",{class:"text-gatales-text-secondary text-xs"},"Costo USD",-1)),t("p",Vt,"$"+s((i.value.period_totals?.total_cost||0).toFixed(4)),1)])])])])]),i.value.daily?.length>0?(l(),o("div",It,[e[37]||(e[37]=t("h3",{class:"text-sm font-medium text-gatales-text-secondary mb-3"},"Desglose Diario",-1)),t("div",Lt,[t("table",Nt,[e[36]||(e[36]=t("thead",null,[t("tr",{class:"border-b border-gatales-border text-left"},[t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium"},"Fecha"),t("th",{class:"py-2 px-3 text-green-400 font-medium text-right"},"OpenAI"),t("th",{class:"py-2 px-3 text-green-400 font-medium text-right"},"Costo"),t("th",{class:"py-2 px-3 text-blue-400 font-medium text-right"},"DeepSeek"),t("th",{class:"py-2 px-3 text-blue-400 font-medium text-right"},"Costo"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium text-right"},"Total"),t("th",{class:"py-2 px-3 text-amber-400 font-medium text-right"},"Costo Total")])],-1)),t("tbody",null,[(l(!0),o(y,null,C([...i.value.daily].reverse(),a=>(l(),o("tr",{key:a.date,class:"border-b border-gatales-border/50 hover:bg-gatales-input/50"},[t("td",Bt,s(a.date),1),t("td",Ot,s(r(a.openai?.total||0)),1),t("td",Rt,"$"+s((a.openai?.cost||0).toFixed(4)),1),t("td",zt,s(r(a.deepseek?.total||0)),1),t("td",qt,"$"+s((a.deepseek?.cost||0).toFixed(4)),1),t("td",Ht,s(r(a.total||0)),1),t("td",Kt,"$"+s((a.total_cost||0).toFixed(4)),1)]))),128))])])])])):(l(),o("div",Gt," No hay datos de consumo "))])):u("",!0),t("div",Jt,[t("h2",Qt,"Conversaciones ("+s(m.value.length)+")",1),m.value.length===0?(l(),o("div",Wt," No hay conversaciones ")):(l(),o("div",Xt,[t("table",Yt,[e[39]||(e[39]=t("thead",null,[t("tr",{class:"border-b border-gatales-border text-left"},[t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium"},"Título"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium text-center"},"Mensajes"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium text-right"},"Tokens Input"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium text-right"},"Tokens Output"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium text-right"},"Total Tokens"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium text-right"},"Costo USD"),t("th",{class:"py-2 px-3 text-gatales-text-secondary font-medium text-right"},"Último mensaje")])],-1)),t("tbody",null,[(l(!0),o(y,null,C(m.value,a=>(l(),o("tr",{key:a.id,class:"border-b border-gatales-border/50 hover:bg-gatales-input/50"},[t("td",{class:"py-2 px-3 text-gatales-text max-w-xs truncate",title:a.title},s(a.title),9,Zt),t("td",te,s(a.messages_count),1),t("td",ee,s(r(a.tokens_input)),1),t("td",se,s(r(a.tokens_output)),1),t("td",ae,s(r(a.total_tokens)),1),t("td",oe,"$"+s((a.estimated_cost||0).toFixed(4)),1),t("td",le,s(a.last_message_at?h(a.last_message_at):"-"),1)]))),128))])])]))])],64)):u("",!0),p.value?(l(),o("div",ne,[t("div",de,[e[40]||(e[40]=t("h3",{class:"text-lg font-semibold text-gatales-text mb-4"},"Agregar Tokens",-1)),D(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>b.value=a),type:"number",min:"1",class:"input-field mb-4",placeholder:"Cantidad de tokens"},null,512),[[L,b.value,void 0,{number:!0}]]),t("div",ie,[t("button",{onClick:e[4]||(e[4]=a=>p.value=!1),class:"btn-secondary"}," Cancelar "),t("button",{onClick:E,class:"btn-primary"}," Agregar ")])])])):u("",!0),v.value?(l(),o("div",re,[t("div",xe,[e[41]||(e[41]=t("h3",{class:"text-lg font-semibold text-gatales-text mb-4"},"Cambiar Plan",-1)),D(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>_.value=a),class:"input-field mb-4"},[(l(!0),o(y,null,C(w.value,a=>(l(),o("option",{key:a.id,value:a.id},s(a.name)+" - "+s(r(a.tokens_monthly))+" tokens/mes ",9,ue))),128))],512),[[N,_.value]]),e[42]||(e[42]=t("p",{class:"text-sm text-gatales-text-secondary mb-4"}," Los tokens del usuario se renovarán al cambiar de plan. ",-1)),t("div",ce,[t("button",{onClick:e[6]||(e[6]=a=>v.value=!1),class:"btn-secondary"}," Cancelar "),t("button",{onClick:A,class:"btn-primary"}," Cambiar ")])])])):u("",!0)]))}};export{pe as default};
