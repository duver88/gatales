import{l as $,x as S,c as o,a as e,i as E,e as c,v,L as _,b as F,F as M,y as j,d as m,t as n,K as C,r,k as I,o as i,p as q,w as H}from"./index-DnaU9Zpc.js";const R={class:"p-6"},J={class:"flex flex-col md:flex-row gap-4 mb-6"},K={key:0,class:"text-gatales-text-secondary"},G={key:1,class:"card overflow-x-auto"},O={class:"w-full"},Q=["onClick"],W={class:"py-3 pr-4"},X={class:"text-sm font-medium text-gatales-text"},Y={class:"text-xs text-gatales-text-secondary"},Z={class:"py-3 pr-4 text-sm text-gatales-text"},ee={class:"py-3 pr-4"},te={class:"py-3 pr-4 text-sm text-gatales-text"},se={class:"py-3 pr-4 text-sm text-gatales-text-secondary"},ae={class:"py-3"},le=["onClick"],oe={key:0,class:"text-center py-8 text-gatales-text-secondary"},ne={key:2,class:"flex justify-center gap-2 mt-6"},ie=["disabled"],re={class:"text-gatales-text-secondary text-sm self-center"},de=["disabled"],ue={key:3,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},ce={class:"card max-w-md w-full max-h-[90vh] overflow-y-auto"},pe={key:0,class:"bg-red-500/20 text-red-400 p-3 rounded mb-4 text-sm"},ve={class:"space-y-3 mb-4"},me=["value"],xe={class:"flex gap-2"},be=["disabled"],ge=["disabled"],fe={key:0,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},we={__name:"UsersView",setup(ye){const N=I(),y=r([]),x=r({}),k=r(!0),b=r(""),g=r(""),d=r(1),w=r(!1),p=r(!1),h=r([]),a=r({name:"",email:"",password:"",plan_id:"",tokens_balance:"",status:"active"}),u=r("");async function f(){k.value=!0;try{const l=await C.getUsers({search:b.value||void 0,status:g.value||void 0,page:d.value,per_page:15});y.value=l.data.users,x.value=l.data.pagination}catch(l){console.error("Error fetching users:",l)}finally{k.value=!1}}async function P(){try{const l=await C.getPlans();h.value=l.data.plans}catch(l){console.error("Error fetching plans:",l)}}$(()=>{f(),P()}),S([b,g],()=>{d.value=1,f()}),S(d,f);function L(l){return l.toLocaleString("es-ES")}function A(l){return new Date(l).toLocaleDateString("es-ES")}function B(l){const t={active:"bg-green-500/20 text-green-400",pending:"bg-yellow-500/20 text-yellow-400",inactive:"bg-red-500/20 text-red-400",suspended:"bg-gray-500/20 text-gray-400"};return t[l]||t.inactive}function U(l){N.push(`/admin/users/${l}`)}function D(){a.value={name:"",email:"",password:"",plan_id:"",tokens_balance:"",status:"active"},u.value="",w.value=!0}function V(){w.value=!1}async function z(){if(!a.value.name.trim()){u.value="El nombre es requerido";return}if(!a.value.email.trim()){u.value="El email es requerido";return}if(!a.value.password||a.value.password.length<6){u.value="La contraseña debe tener al menos 6 caracteres";return}p.value=!0,u.value="";try{const l={name:a.value.name,email:a.value.email,password:a.value.password,status:a.value.status};a.value.plan_id&&(l.plan_id=a.value.plan_id),a.value.tokens_balance!==""&&(l.tokens_balance=parseInt(a.value.tokens_balance)),await C.createUser(l),await f(),V()}catch(l){u.value=l.response?.data?.message||"Error al crear el usuario"}finally{p.value=!1}}return(l,t)=>(i(),o("div",R,[e("div",{class:"flex justify-between items-center mb-6"},[t[11]||(t[11]=e("h1",{class:"text-2xl font-bold text-gatales-text"},"Usuarios",-1)),e("button",{onClick:D,class:"btn-primary flex items-center gap-2"},[...t[10]||(t[10]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),E(" Nuevo Usuario ",-1)])])]),e("div",J,[c(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>b.value=s),type:"text",placeholder:"Buscar por email o nombre...",class:"input-field md:w-80"},null,512),[[v,b.value]]),c(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>g.value=s),class:"input-field md:w-40"},[...t[12]||(t[12]=[F('<option value="">Todos los estados</option><option value="active">Activo</option><option value="pending">Pendiente</option><option value="inactive">Inactivo</option><option value="suspended">Suspendido</option>',5)])],512),[[_,g.value]])]),k.value?(i(),o("div",K,"Cargando...")):(i(),o("div",G,[e("table",O,[t[13]||(t[13]=e("thead",null,[e("tr",{class:"text-left text-sm text-gatales-text-secondary border-b border-gatales-border"},[e("th",{class:"pb-3 pr-4"},"Usuario"),e("th",{class:"pb-3 pr-4"},"Plan"),e("th",{class:"pb-3 pr-4"},"Estado"),e("th",{class:"pb-3 pr-4"},"Tokens"),e("th",{class:"pb-3 pr-4"},"Registro"),e("th",{class:"pb-3"},"Acciones")])],-1)),e("tbody",null,[(i(!0),o(M,null,j(y.value,s=>(i(),o("tr",{key:s.id,class:"border-b border-gatales-border/50 hover:bg-gatales-input/50 cursor-pointer",onClick:T=>U(s.id)},[e("td",W,[e("p",X,n(s.name),1),e("p",Y,n(s.email),1)]),e("td",Z,n(s.active_subscription?.plan?.name||"Sin plan"),1),e("td",ee,[e("span",{class:q(["px-2 py-1 rounded text-xs",B(s.status)])},n(s.status),3)]),e("td",te,n(L(s.tokens_balance)),1),e("td",se,n(A(s.created_at)),1),e("td",ae,[e("button",{onClick:H(T=>U(s.id),["stop"]),class:"text-gatales-accent hover:underline text-sm"}," Ver detalle ",8,le)])],8,Q))),128))])]),y.value.length===0?(i(),o("div",oe," No se encontraron usuarios ")):m("",!0)])),x.value.last_page>1?(i(),o("div",ne,[e("button",{onClick:t[2]||(t[2]=s=>d.value--),disabled:d.value===1,class:"btn-secondary px-3 py-1 text-sm"}," Anterior ",8,ie),e("span",re," Página "+n(d.value)+" de "+n(x.value.last_page),1),e("button",{onClick:t[3]||(t[3]=s=>d.value++),disabled:d.value===x.value.last_page,class:"btn-secondary px-3 py-1 text-sm"}," Siguiente ",8,de)])):m("",!0),w.value?(i(),o("div",ue,[e("div",ce,[t[24]||(t[24]=e("h3",{class:"text-lg font-semibold text-gatales-text mb-4"},"Nuevo Usuario",-1)),u.value?(i(),o("div",pe,n(u.value),1)):m("",!0),e("div",ve,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Nombre *",-1)),c(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>a.value.name=s),type:"text",class:"input-field text-sm",placeholder:"Juan Perez"},null,512),[[v,a.value.name]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Email *",-1)),c(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>a.value.email=s),type:"email",class:"input-field text-sm",placeholder:"juan@ejemplo.com"},null,512),[[v,a.value.email]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Contraseña *",-1)),c(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>a.value.password=s),type:"password",class:"input-field text-sm",placeholder:"Minimo 6 caracteres"},null,512),[[v,a.value.password]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Plan",-1)),c(e("select",{"onUpdate:modelValue":t[7]||(t[7]=s=>a.value.plan_id=s),class:"input-field text-sm"},[t[17]||(t[17]=e("option",{value:""},"Sin plan",-1)),(i(!0),o(M,null,j(h.value,s=>(i(),o("option",{key:s.id,value:s.id},n(s.name)+" ("+n(s.tokens_monthly.toLocaleString())+" tokens) ",9,me))),128))],512),[[_,a.value.plan_id]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Tokens iniciales",-1)),c(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>a.value.tokens_balance=s),type:"number",class:"input-field text-sm",placeholder:"Dejar vacio para usar tokens del plan"},null,512),[[v,a.value.tokens_balance]]),t[20]||(t[20]=e("p",{class:"text-xs text-gatales-text-secondary mt-1"},"Si se deja vacio, se usaran los tokens del plan seleccionado",-1))]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm text-gatales-text-secondary mb-1"},"Estado",-1)),c(e("select",{"onUpdate:modelValue":t[9]||(t[9]=s=>a.value.status=s),class:"input-field text-sm"},[...t[21]||(t[21]=[e("option",{value:"active"},"Activo",-1),e("option",{value:"pending"},"Pendiente",-1),e("option",{value:"inactive"},"Inactivo",-1)])],512),[[_,a.value.status]])])]),e("div",xe,[e("button",{onClick:V,disabled:p.value,class:"btn-secondary flex-1 text-sm"}," Cancelar ",8,be),e("button",{onClick:z,disabled:p.value,class:"btn-primary flex-1 text-sm flex items-center justify-center gap-2"},[p.value?(i(),o("svg",fe,[...t[23]||(t[23]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):m("",!0),E(" "+n(p.value?"Creando...":"Crear Usuario"),1)],8,ge)])])])):m("",!0)]))}};export{we as default};
